//+------------------------------------------------------------------+
//| Expert inputs                                                    |
//+------------------------------------------------------------------+
input string FilePrefix = "Van_";       // Prefix voor bestandsnaam
input string ChartText = "Trades worden ge-exporteerd...";  // Tekst op de chart

//+------------------------------------------------------------------+
//| Interne lijst van verwerkte trades                               |
//+------------------------------------------------------------------+
#include <Arrays\ArrayLong.mqh>
CArrayLong processedTickets;

//+------------------------------------------------------------------+
//| Expert initialization function                                   |
//+------------------------------------------------------------------+
int OnInit()
  {
   // Tekst op de chart
   string label_name = "ExportLabel";
   ObjectCreate(0, label_name, OBJ_LABEL, 0, 0, 0);
   ObjectSetInteger(0, label_name, OBJPROP_CORNER, CORNER_LEFT_UPPER);
   ObjectSetInteger(0, label_name, OBJPROP_XDISTANCE, 10);
   ObjectSetInteger(0, label_name, OBJPROP_YDISTANCE, 10);
   ObjectSetInteger(0, label_name, OBJPROP_FONTSIZE, 12);
   ObjectSetString(0, label_name, OBJPROP_TEXT, ChartText);

   return(INIT_SUCCEEDED);
  }

//+------------------------------------------------------------------+
//| Expert tick function                                             |
//+------------------------------------------------------------------+
void OnTick()
  {
   int total = PositionsTotal();
   for(int i = 0; i < total; i++)
     {
      ulong ticket = PositionGetTicket(i);

      // Alleen doorgaan als ticket nog niet verwerkt is
      if(processedTickets.Search(ticket) == -1)
        {
         if(PositionSelectByTicket(ticket))
           {
            string symbol = PositionGetString(POSITION_SYMBOL);
            int type = (int)PositionGetInteger(POSITION_TYPE);
            string direction = (type == POSITION_TYPE_BUY) ? "Buy" : "Sell";

            string filename = FilePrefix + (string)ticket + ".trade";
            int file_handle = FileOpen(filename, FILE_WRITE | FILE_TXT);

            if(file_handle != INVALID_HANDLE)
              {
               string line = symbol + ";" + direction;
               FileWrite(file_handle, line);
               FileClose(file_handle);

               // Voeg ticket toe aan verwerkte lijst
               processedTickets
